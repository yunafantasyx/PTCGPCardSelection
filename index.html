<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å®å¯æ¢¦å¡ç‰Œç”Ÿæˆå™¨</title>
<style>
body { font-family: Arial; margin:20px; display:flex; gap:20px; }
.left { flex:3; overflow-y:auto; }
.right { flex:1; max-width:25%; }
h1 { font-size:20px; margin-bottom:15px; }
label { font-size:14px; margin-right:5px; }
input[type=text] { padding:4px; font-size:14px; width:150px; }
.set-selector { margin-bottom: 15px; }
.set-button { padding:6px 12px; margin:3px; border-radius:6px; border:1px solid #888; background:#e0e0e0; cursor:pointer; font-size:13px; }
.set-button.selected { background:#2196F3; color:white; }
.button-container { display:flex; flex-wrap:wrap; gap:6px; margin:10px 0; }
.card-button { padding:6px 10px; border-radius:6px; border:1px solid #888; background:#f0f0f0; cursor:pointer; font-size:13px; width:120px; text-align:center; flex-shrink:0; }
.card-button.selected { background:#4CAF50; color:white; }
.card-button.hidden { display:none; }
textarea { width:100%; height:100px; margin-top:10px; font-size:14px; padding:5px; }
.preview { border:1px solid #ccc; padding:10px; background:#fafafa; }
.preview h3 { font-size:14px; margin-top:0; margin-bottom:10px; }
.preview img { width:90px; height:auto; margin:4px; border:1px solid #ddd; object-fit:contain; }
.action-buttons { margin-top:10px; }
.action-buttons button { margin-right:8px; padding:5px 10px; font-size:13px; border-radius:6px; border:1px solid #888; background:#f0f0f0; cursor:pointer; }
.history { margin-top:15px; }
.history-item { margin-bottom:5px; font-size:13px; cursor:pointer; }
.card-type { font-size: 12px; color: #666; }
.ex-card { border-left: 3px solid #ff6b35; }
.trainer-card { border-left: 3px solid #4a90e2; }
.rainbow-card { border-left: 3px solid #9b59b6; }
</style>
</head>
<body>
<div class="left">
  <h1>å®å¯æ¢¦å¡ç‰Œç”Ÿæˆå™¨</h1>

  <div style="margin-bottom:10px;">
    <label for="idInput">ID:</label>
    <input id="idInput" type="text">
    <label for="nameInput" style="margin-left:10px;">å§“å/æ—¶é—´æˆ³:</label>
    <input id="nameInput" type="text">
  </div>

  <div class="set-selector">
    <label>é€‰æ‹©SET:</label>
    <div id="setButtons"></div>
  </div>

  <div class="action-buttons">
    <button onclick="selectAll()">å…¨é€‰</button>
    <button onclick="deselectAll()">å…¨ä¸é€‰</button>
    <button onclick="invertSelection()">åé€‰</button>
    <button onclick="selectByType('ex')">é€‰æ‹©æ‰€æœ‰EXå¡</button>
    <button onclick="selectByType('trainer')">é€‰æ‹©æ‰€æœ‰è®­ç»ƒå¸ˆ</button>
    <button onclick="selectByType('rainbow')">é€‰æ‹©æ‰€æœ‰å½©å¡</button>
  </div>

  <div class="button-container" id="cardButtons"></div>

  <div class="action-buttons">
    <button onclick="generate()">ç”Ÿæˆ</button>
    <button onclick="copyText()">å¤åˆ¶</button>
    <button onclick="downloadText()">ä¸‹è½½</button>
  </div>

  <textarea id="output" readonly></textarea>

  <div class="history">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0; font-size:14px;">å†å²è®°å½•</h3>
      <div>
        <input type="text" id="historySearch" placeholder="æœç´¢å†å²..." style="padding:4px; font-size:12px;" oninput="filterHistory()">
        <button style="padding:4px 8px; font-size:12px; border-radius:6px; border:1px solid #888; background:#f0f0f0; margin-left:5px;" onclick="clearHistory()">æ¸…ç©º</button>
      </div>
    </div>
    <div id="historyList"></div>
  </div>
</div>

<div class="right preview">
  <h3>å·²é€‰å¡ç‰Œé¢„è§ˆ</h3>
  <div id="previewArea"></div>
</div>

<script>
// è§£æCSVæ•°æ®
const cardData = `A1_251,A1,å¦™è›™èŠ±ex,ğŸŒŒâ­ï¸â­ï¸
A1_252,A1,æ¤°è›‹æ ‘ex,ğŸŒŒâ­ï¸â­ï¸
A1_253,A1,å–·ç«é¾™ex,ğŸŒŒâ­ï¸â­ï¸
A1_254,A1,é£é€Ÿç‹—ex,ğŸŒŒâ­ï¸â­ï¸
A1_255,A1,ç«ç„°é¸Ÿex,ğŸŒŒâ­ï¸â­ï¸
A1_256,A1,æ°´ç®­é¾Ÿex,ğŸŒŒâ­ï¸â­ï¸
A1_257,A1,å®çŸ³æµ·æ˜Ÿex,ğŸŒŒâ­ï¸â­ï¸
A1_258,A1,æ€¥å†»é¸Ÿex,ğŸŒŒâ­ï¸â­ï¸
A1_259,A1,çš®å¡ä¸˜ex,ğŸŒŒâ­ï¸â­ï¸
A1_260,A1,é—ªç”µé¸Ÿex,ğŸŒŒâ­ï¸â­ï¸
A1_261,A1,è€¿é¬¼ex,ğŸŒŒâ­ï¸â­ï¸
A1_262,A1,è¶…æ¢¦ex,ğŸŒŒâ­ï¸â­ï¸
A1_263,A1,æ€ªåŠ›ex,ğŸŒŒâ­ï¸â­ï¸
A1_264,A1,å˜å•¦å˜å•¦ex,ğŸŒŒâ­ï¸â­ï¸
A1_265,A1,èƒ–å¯ä¸ex,ğŸŒŒâ­ï¸â­ï¸
A1_266,A1,è‰ä½³,ğŸ¤¡â­ï¸â­
A1_267,A1,å°éœ,ğŸ¤¡â­ï¸â­
A1_268,A1,å¤ä¼¯,ğŸ¤¡â­ï¸â­
A1_269,A1,é˜¿æ¡”,ğŸ¤¡â­ï¸â­
A1_270,A1,å‚æœ¨,ğŸ¤¡â­ï¸â­
A1_271,A1,å°åˆš,ğŸ¤¡â­ï¸â­
A1_272,A1,å¨œå§¿,ğŸ¤¡â­ï¸â­
A1_273,A1,é©¬å¿—å£«,ğŸ¤¡â­ï¸â­
A1_274,A1,ç«ç„°é¸Ÿex,ğŸŒˆâ­ï¸â­ï¸
A1_275,A1,æ€¥å†»é¸Ÿex,ğŸŒˆâ­ï¸â­ï¸
A1_276,A1,é—ªç”µé¸Ÿex,ğŸŒˆâ­ï¸â­ï¸
A1_277,A1,è€¿é¬¼ex,ğŸŒˆâ­ï¸â­ï¸
A1_278,A1,æ€ªåŠ›ex,ğŸŒˆâ­ï¸â­ï¸
A1_279,A1,èƒ–å¯ä¸ex,ğŸŒˆâ­ï¸â­ï¸
A1a_075,A1a,æ—¶æ‹‰æ¯”ex,ğŸŒŒâ­ï¸â­ï¸
A1a_076,A1a,æš´é²¤é¾™ex,ğŸŒŒâ­ï¸â­ï¸
A1a_077,A1a,æ¢¦å¹»ex,ğŸŒŒâ­ï¸â­ï¸
A1a_078,A1a,åŒ–çŸ³ç¿¼é¾™ex,ğŸŒŒâ­ï¸â­ï¸
A1a_079,A1a,å¤§æ¯”é¸Ÿex,ğŸŒŒâ­ï¸â­ï¸
A1a_080,A1a,æ–°èŠ½æ¢é™©å®¶,ğŸ¤¡â­ï¸â­
A1a_081,A1a,é’ç»¿,ğŸ¤¡â­ï¸â­
A1a_082,A1a,å¶å­,ğŸ¤¡â­ï¸â­
A1a_083,A1a,æ¢¦å¹»ex,ğŸŒˆâ­ï¸â­ï¸
A1a_084,A1a,åŒ–çŸ³ç¿¼é¾™ex,ğŸŒˆâ­ï¸â­ï¸
A2_180,A2,è¿œå¤å·¨èœ“ex,ğŸŒŒâ­ï¸â­ï¸
A2_181,A2,çƒˆç„°çŒ´ex,ğŸŒŒâ­ï¸â­ï¸
A2_182,A2,å¸•è·¯å¥‡äºšex,ğŸŒŒâ­ï¸â­ï¸
A2_183,A2,å¸•å¥‡åˆ©å…¹ex,ğŸŒŒâ­ï¸â­ï¸
A2_184,A2,æ¢¦å¦–é­”ex,ğŸŒŒâ­ï¸â­ï¸
A2_185,A2,è‰¾è·¯é›·æœµex,ğŸŒŒâ­ï¸â­ï¸
A2_186,A2,ç›ç‹ƒæ‹‰ex,ğŸŒŒâ­ï¸â­ï¸
A2_187,A2,è¾¾å…‹è±ä¼Šex,ğŸŒŒâ­ï¸â­ï¸
A2_188,A2,å¸ç‰™å¢å¡ex,ğŸŒŒâ­ï¸â­ï¸
A2_189,A2,å¤§èˆŒèˆ”ex,ğŸŒŒâ­ï¸â­ï¸
A2_190,A2,èµ¤æ—¥,ğŸ¤¡â­ï¸â­
A2_191,A2,é“¶æ²³é˜Ÿæ‰‹ä¸‹,ğŸ¤¡â­ï¸â­
A2_192,A2,ç«¹å…°,ğŸ¤¡â­ï¸â­
A2_193,A2,ç”µæ¬¡,ğŸ¤¡â­ï¸â­
A2_194,A2,å°å…‰,ğŸ¤¡â­ï¸â­
A2_195,A2,ç«æ˜Ÿ,ğŸ¤¡â­ï¸â­
A2_196,A2,è¿œå¤å·¨èœ“ex,ğŸŒˆâ­ï¸â­ï¸
A2_197,A2,çƒˆç„°çŒ´ex,ğŸŒˆâ­ï¸â­ï¸
A2_198,A2,å¸•å¥‡åˆ©å…¹ex,ğŸŒˆâ­ï¸â­ï¸
A2_199,A2,æ¢¦å¦–é­”ex,ğŸŒˆâ­ï¸â­ï¸
A2_200,A2,è‰¾è·¯é›·æœµex,ğŸŒˆâ­ï¸â­ï¸
A2_201,A2,ç›ç‹ƒæ‹‰ex,ğŸŒˆâ­ï¸â­ï¸
A2_202,A2,è¾¾å…‹è±ä¼Šex,ğŸŒˆâ­ï¸â­ï¸
A2_203,A2,å¤§èˆŒèˆ”ex,ğŸŒˆâ­ï¸â­ï¸
A2a_082,A2a,å¶ä¼Šå¸ƒex,ğŸŒŒâ­ï¸â­ï¸
A2a_083,A2a,å†°ä¼Šå¸ƒex,ğŸŒŒâ­ï¸â­ï¸
A2a_084,A2a,çƒˆå’¬é™†é²¨ex,ğŸŒŒâ­ï¸â­ï¸
A2a_085,A2a,å¤§æœåŒ—é¼»ex,ğŸŒŒâ­ï¸â­ï¸
A2a_086,A2a,é˜¿å°”å®™æ–¯ex,ğŸŒŒâ­ï¸â­ï¸
A2a_087,A2a,ç è´,ğŸ¤¡â­ï¸â­
A2a_088,A2a,ç¥å’Œé•‡é•¿è€,ğŸ¤¡â­ï¸â­
A2a_089,A2a,é˜¿é©¯,ğŸ¤¡â­ï¸â­
A2a_090,A2a,åˆšçŸ³,ğŸ¤¡â­ï¸â­
A2a_091,A2a,å¶ä¼Šå¸ƒex,ğŸŒˆâ­ï¸â­ï¸
A2a_092,A2a,å†°ä¼Šå¸ƒex,ğŸŒˆâ­ï¸â­ï¸
A2a_093,A2a,çƒˆå’¬é™†é²¨ex,ğŸŒˆâ­ï¸â­ï¸
A2a_094,A2a,å¤§æœåŒ—é¼»ex,ğŸŒˆâ­ï¸â­ï¸
A2b_079,A2b,å¤§é’ˆèœ‚ex,ğŸŒŒâ­ï¸â­ï¸
A2b_080,A2b,å–·ç«é¾™ex,ğŸŒŒâ­ï¸â­ï¸
A2b_081,A2b,ä¸‰æµ·åœ°é¼ ex,ğŸŒŒâ­ï¸â­ï¸
A2b_082,A2b,çš®å¡ä¸˜ex,ğŸŒŒâ­ï¸â­ï¸
A2b_083,A2b,éª‘æ‹‰å¸çº³ex,ğŸŒŒâ­ï¸â­ï¸
A2b_084,A2b,è·¯å¡åˆ©æ¬§ex,ğŸŒŒâ­ï¸â­ï¸
A2b_085,A2b,å¸•åº•äºšåœŸç‹ex,ğŸŒŒâ­ï¸â­ï¸
A2b_086,A2b,å·¨é”»åŒ ex,ğŸŒŒâ­ï¸â­ï¸
A2b_087,A2b,å¤§å°¾ç‹¸ex,ğŸŒŒâ­ï¸â­ï¸
A2b_088,A2b,å¥‡æ ‘,ğŸ¤¡â­ï¸â­
A2b_089,A2b,å®å¯æ¢¦ä¸­å¿ƒå°å§,ğŸ¤¡â­ï¸â­
A2b_090,A2b,èµ¤çº¢,ğŸ¤¡â­ï¸â­
A2b_091,A2b,ç«ç®­é˜Ÿå°å…µ,ğŸ¤¡â­ï¸â­
A2b_092,A2b,çš®å¡ä¸˜ex,ğŸŒˆâ­ï¸â­ï¸
A2b_093,A2b,å¸•åº•äºšåœŸç‹ex,ğŸŒˆâ­ï¸â­ï¸
A2b_094,A2b,å·¨é”»åŒ ex,ğŸŒˆâ­ï¸â­ï¸
A2b_095,A2b,å¤§å°¾ç‹¸ex,ğŸŒˆâ­ï¸â­ï¸
A3_180,A3,ç‹™å°„æ ‘æ­ex,ğŸŒŒâ­ï¸â­ï¸
A3_181,A3,ç ´ç ´èˆµè½®ex,ğŸŒŒâ­ï¸â­ï¸
A3_182,A3,ç‚½ç„°å’†å“®è™ex,ğŸŒŒâ­ï¸â­ï¸
A3_183,A3,å¥½èƒœæ¯›èŸ¹ex,ğŸŒŒâ­ï¸â­ï¸
A3_184,A3,å¼±ä¸é±¼ex,ğŸŒŒâ­ï¸â­ï¸
A3_185,A3,é˜¿ç½—æ‹‰é›·ä¸˜ex,ğŸŒŒâ­ï¸â­ï¸
A3_186,A3,éœ²å¥ˆé›…æ‹‰ex,ğŸŒŒâ­ï¸â­ï¸
A3_187,A3,æŠ•æ·çŒ´ex,ğŸŒŒâ­ï¸â­ï¸
A3_188,A3,é˜¿ç½—æ‹‰è‡­è‡­æ³¥ex,ğŸŒŒâ­ï¸â­ï¸
A3_189,A3,ç´¢å°”è¿¦é›·æ¬§ex,ğŸŒŒâ­ï¸â­ï¸
A3_190,A3,é˜¿å¡ç½—æ‹‰,ğŸ¤¡â­ï¸â­
A3_191,A3,ä¼Šåˆ©é©¬,ğŸ¤¡â­ï¸â­
A3_192,A3,å¡å¥‡,ğŸ¤¡â­ï¸â­
A3_193,A3,å¤å…¹é©¬,ğŸ¤¡â­ï¸â­
A3_194,A3,æ°´è²,ğŸ¤¡â­ï¸â­
A3_195,A3,é©¬ç›å†…,ğŸ¤¡â­ï¸â­
A3_196,A3,ç›å¥¥,ğŸ¤¡â­ï¸â­
A3_197,A3,è‰è‰è‰¾,ğŸ¤¡â­ï¸â­
A3_198,A3,ç‹™å°„æ ‘æ­ex,ğŸŒˆâ­ï¸â­ï¸
A3_199,A3,ç ´ç ´èˆµè½®ex,ğŸŒˆâ­ï¸â­ï¸
A3_200,A3,ç‚½ç„°å’†å“®è™ex,ğŸŒˆâ­ï¸â­ï¸
A3_201,A3,å¥½èƒœæ¯›èŸ¹ex,ğŸŒˆâ­ï¸â­ï¸
A3_202,A3,å¼±ä¸é±¼ex,ğŸŒˆâ­ï¸â­ï¸
A3_203,A3,é˜¿ç½—æ‹‰é›·ä¸˜ex,ğŸŒˆâ­ï¸â­ï¸
A3_204,A3,éœ²å¥ˆé›…æ‹‰ex,ğŸŒˆâ­ï¸â­ï¸
A3_205,A3,æŠ•æ·çŒ´ex,ğŸŒˆâ­ï¸â­ï¸
A3_206,A3,é˜¿ç½—æ‹‰è‡­è‡­æ³¥ex,ğŸŒˆâ­ï¸â­ï¸
A3_207,A3,ç´¢å°”è¿¦é›·æ¬§ex,ğŸŒˆâ­ï¸â­ï¸
A3a_076,A3a,çˆ†è‚ŒèšŠex,ğŸŒŒâ­ï¸â­ï¸
A3a_077,A3a,å¡ç’ãƒ»é¸£é¸£ex,ğŸŒŒâ­ï¸â­ï¸
A3a_078,A3a,é¬ƒå²©ç‹¼äººex,ğŸŒŒâ­ï¸â­ï¸
A3a_079,A3a,æ¶é£Ÿå¤§ç‹ex,ğŸŒŒâ­ï¸â­ï¸
A3a_080,A3a,é˜¿ç½—æ‹‰ä¸‰åœ°é¼ ex,ğŸŒŒâ­ï¸â­ï¸
A3a_081,A3a,æ ¼æ‹‰å‰æ¬§,ğŸ¤¡â­ï¸â­
A3a_082,A3a,å¸…å“¥,ğŸ¤¡â­ï¸â­
A3a_083,A3a,éœ²èç±³å¥ˆ,ğŸ¤¡â­ï¸â­
A3a_084,A3a,å¡ç’ãƒ»é¸£é¸£ex,ğŸŒˆâ­ï¸â­ï¸
A3a_085,A3a,é¬ƒå²©ç‹¼äººex,ğŸŒˆâ­ï¸â­ï¸
A3a_086,A3a,æ¶é£Ÿå¤§ç‹ex,ğŸŒˆâ­ï¸â­ï¸
A3a_087,A3a,é˜¿ç½—æ‹‰ä¸‰åœ°é¼ ex,ğŸŒˆâ­ï¸â­ï¸
A3b_079,A3b,ç«ä¼Šå¸ƒex,ğŸŒŒâ­ï¸â­ï¸
A3b_080,A3b,è¥¿ç‹®æµ·å£¬ex,ğŸŒŒâ­ï¸â­ï¸
A3b_081,A3b,ä»™å­ä¼Šå¸ƒex,ğŸŒŒâ­ï¸â­ï¸
A3b_082,A3b,å¿«é¾™ex,ğŸŒŒâ­ï¸â­ï¸
A3b_083,A3b,ä¼Šå¸ƒex,ğŸŒŒâ­ï¸â­ï¸
A3b_084,A3b,å¡æ¯”å…½ex,ğŸŒŒâ­ï¸â­ï¸
A3b_085,A3b,å“ˆä¹Œ,ğŸ¤¡â­ï¸â­
A3b_086,A3b,ç‰¡ä¸¹,ğŸ¤¡â­ï¸â­
A3b_087,A3b,ç«ä¼Šå¸ƒex,ğŸŒˆâ­ï¸â­ï¸
A3b_088,A3b,è¥¿ç‹®æµ·å£¬ex,ğŸŒˆâ­ï¸â­ï¸
A3b_089,A3b,ä»™å­ä¼Šå¸ƒex,ğŸŒˆâ­ï¸â­ï¸
A3b_090,A3b,å¿«é¾™ex,ğŸŒˆâ­ï¸â­ï¸
A3b_091,A3b,å¡æ¯”å…½ex,ğŸŒˆâ­ï¸â­ï¸
A4_186,A4,å£¶å£¶ex,ğŸŒŒâ­ï¸â­ï¸
A4_187,A4,å‡¤ç‹ex,ğŸŒŒâ­ï¸â­ï¸
A4_188,A4,åˆºé¾™ç‹ex,ğŸŒŒâ­ï¸â­ï¸
A4_189,A4,ç”µç¯æ€ªex,ğŸŒŒâ­ï¸â­ï¸
A4_190,A4,å¤ªé˜³ä¼Šå¸ƒex,ğŸŒŒâ­ï¸â­ï¸
A4_191,A4,é¡¿ç”²ex,ğŸŒŒâ­ï¸â­ï¸
A4_192,A4,å‰å­—è ex,ğŸŒŒâ­ï¸â­ï¸
A4_193,A4,æœˆäº®ä¼Šå¸ƒex,ğŸŒŒâ­ï¸â­ï¸
A4_194,A4,ç›”ç”²é¸Ÿex,ğŸŒŒâ­ï¸â­ï¸
A4_195,A4,æ´›å¥‡äºšex,ğŸŒŒâ­ï¸â­ï¸
A4_196,A4,ä¸€æ ‘,ğŸ¤¡â­ï¸â­
A4_197,A4,ç´éŸ³,ğŸ¤¡â­ï¸â­
A4_198,A4,é“¶,ğŸ¤¡â­ï¸â­
A4_199,A4,é’“é±¼è€…,ğŸ¤¡â­ï¸â­
A4_200,A4,é˜¿èœœ,ğŸ¤¡â­ï¸â­
A4_201,A4,ç™»å±±ç”·,ğŸ¤¡â­ï¸â­
A4_202,A4,å£¶å£¶ex,ğŸŒˆâ­ï¸â­ï¸
A4_203,A4,åˆºé¾™ç‹ex,ğŸŒˆâ­ï¸â­ï¸
A4_204,A4,ç”µç¯æ€ªex,ğŸŒˆâ­ï¸â­ï¸
A4_205,A4,å¤ªé˜³ä¼Šå¸ƒex,ğŸŒˆâ­ï¸â­ï¸
A4_206,A4,é¡¿ç”²ex,ğŸŒˆâ­ï¸â­ï¸
A4_207,A4,å‰å­—è ex,ğŸŒˆâ­ï¸â­ï¸
A4_208,A4,æœˆäº®ä¼Šå¸ƒex,ğŸŒˆâ­ï¸â­ï¸
A4_209,A4,ç›”ç”²é¸Ÿex,ğŸŒˆâ­ï¸â­ï¸`;

// è§£æå¡ç‰Œæ•°æ®
const cards = [];
const sets = new Set();
cardData.split('\n').forEach(line => {
  const [id, set, name, type] = line.split(',');
  if (id && set && name && type) {
    let cardType = 'normal';
    let displayName = name;
    
    if (type.includes('ğŸŒˆ')) {
      cardType = 'rainbow';
      displayName = `ï¼ˆå½©ï¼‰${name}`;
    } else if (type.includes('ğŸ¤¡')) {
      cardType = 'trainer';
    } else if (name.includes('ex')) {
      cardType = 'ex';
    }
    
    cards.push({
      id,
      set,
      name: displayName,
      originalName: name,
      type: cardType,
      emoji: type
    });
    sets.add(set);
  }
});

// æŒ‰SETæ’åº
const sortedSets = Array.from(sets).sort();

const selectedCards = new Set();
const selectedSets = new Set(['A4']); // é»˜è®¤é€‰æ‹©A4
const history = [];

const setButtonsDiv = document.getElementById("setButtons");
const cardButtonsDiv = document.getElementById("cardButtons");
const previewArea = document.getElementById("previewArea");
const output = document.getElementById("output");
const historyList = document.getElementById("historyList");

// åˆå§‹åŒ–SETæŒ‰é’®
sortedSets.forEach(set => {
  const btn = document.createElement("button");
  btn.textContent = set;
  btn.className = "set-button";
  if (selectedSets.has(set)) {
    btn.classList.add("selected");
  }
  btn.onclick = () => toggleSet(set, btn);
  setButtonsDiv.appendChild(btn);
});

// åˆå§‹åŒ–å¡ç‰ŒæŒ‰é’®
cards.forEach(card => {
  const btn = document.createElement("button");
  btn.textContent = `${card.id} ${card.name}`;
  btn.className = `card-button ${card.type}-card`;
  btn.dataset.set = card.set;
  btn.dataset.type = card.type;
  btn.onclick = () => toggleCard(card, btn);
  
  // æ·»åŠ ç±»å‹æ ‡è¯†
  const typeSpan = document.createElement("div");
  typeSpan.className = "card-type";
  typeSpan.textContent = card.emoji;
  btn.appendChild(typeSpan);
  
  cardButtonsDiv.appendChild(btn);
});

// åˆå§‹æ˜¾ç¤º
filterCardsBySet();

function toggleSet(set, btn) {
  if(selectedSets.has(set)){
    selectedSets.delete(set);
    btn.classList.remove("selected");
  } else {
    selectedSets.add(set);
    btn.classList.add("selected");
  }
  filterCardsBySet();
  updatePreview();
}

function filterCardsBySet() {
  const cardButtons = document.querySelectorAll(".card-button");
  cardButtons.forEach(btn => {
    const cardSet = btn.dataset.set;
    if (selectedSets.has(cardSet)) {
      btn.classList.remove("hidden");
    } else {
      btn.classList.add("hidden");
      btn.classList.remove("selected");
      // ä»é€‰ä¸­å¡ç‰Œä¸­ç§»é™¤
      const cardId = btn.textContent.split(' ')[0];
      selectedCards.delete(cardId);
    }
  });
}

function toggleCard(card, btn) {
  if(selectedCards.has(card.id)){
    selectedCards.delete(card.id);
    btn.classList.remove("selected");
  } else {
    selectedCards.add(card.id);
    btn.classList.add("selected");
  }
  updatePreview();
}

function updatePreview() {
  previewArea.innerHTML="";
  selectedCards.forEach(id=>{
    const card = cards.find(c=>c.id===id);
    if (card) {
      const img=document.createElement("img");
      // ä½¿ç”¨å¡ç‰ŒIDçš„å‰ç¼€ä½œä¸ºè·¯å¾„ï¼Œä¾‹å¦‚ A1_251 -> A1
      const pathPrefix = id.split('_')[0];
      img.src=`https://limitlesstcg.nyc3.cdn.digitaloceanspaces.com/pocket/${pathPrefix}/${id}_EN_SM.webp`;
      img.alt=card.name;
      img.title=`${card.id} ${card.name}`;
      img.onerror=()=>{img.src="https://via.placeholder.com/90x120?text=æ— å›¾";};
      previewArea.appendChild(img);
    }
  });
}

function selectAll(){
  selectedCards.clear();
  document.querySelectorAll(".card-button:not(.hidden)").forEach(btn => {
    const cardId = btn.textContent.split(' ')[0];
    selectedCards.add(cardId);
    btn.classList.add("selected");
  });
  updatePreview();
}

function deselectAll(){
  selectedCards.clear();
  document.querySelectorAll(".card-button").forEach(btn=>btn.classList.remove("selected"));
  updatePreview();
}

function invertSelection(){
  const newSelection = new Set();
  document.querySelectorAll(".card-button:not(.hidden)").forEach(btn => {
    const cardId = btn.textContent.split(' ')[0];
    if(selectedCards.has(cardId)){
      btn.classList.remove("selected");
    } else {
      newSelection.add(cardId);
      btn.classList.add("selected");
    }
  });
  selectedCards.clear();
  newSelection.forEach(id=>selectedCards.add(id));
  updatePreview();
}

function selectByType(type) {
  document.querySelectorAll(`.card-button:not(.hidden)[data-type="${type}"]`).forEach(btn => {
    const cardId = btn.textContent.split(' ')[0];
    selectedCards.add(cardId);
    btn.classList.add("selected");
  });
  updatePreview();
}

function generate(){
  const id = document.getElementById("idInput").value.trim();
  const name = document.getElementById("nameInput").value.trim();
  if(!id||!name){ alert("è¯·å¡«å†™IDå’Œå§“å/æ—¶é—´æˆ³"); return;}
  const text = `/æ·»åŠ è€æ¿ ${id} ${name} ${Array.from(selectedCards).join("|")}`;
  output.value=text;

  const now=new Date();
  const timestamp=now.getFullYear()+"-"+(now.getMonth()+1).toString().padStart(2,"0")+"-"+now.getDate().toString().padStart(2,"0")+" "+now.getHours().toString().padStart(2,"0")+":"+now.getMinutes().toString().padStart(2,"0");

  const record={text,id,name,cards:[...selectedCards],sets:[...selectedSets],timestamp};
  history.push(record);
  updateHistory();
}

function copyText(){
  output.select();
  document.execCommand("copy");
  alert("å·²å¤åˆ¶");
}

function downloadText(){
  const blob = new Blob([output.value],{type:"text/plain"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="ç”Ÿæˆç»“æœ.txt";
  link.click();
}

function updateHistory(){
  historyList.innerHTML="";
  history.forEach(item=>{
    const div=document.createElement("div");
    div.className="history-item";
    const setsInfo = item.sets ? ` [${item.sets.join(',')}]` : '';
    div.innerHTML=`${item.text.replace(/\n/g," ")}${setsInfo} <span style="color:gray">(${item.timestamp})</span>`;
    div.onclick=()=>{
      document.getElementById("idInput").value=item.id;
      document.getElementById("nameInput").value=item.name;
      
      // æ¢å¤SETé€‰æ‹©
      selectedSets.clear();
      if (item.sets) {
        item.sets.forEach(set => selectedSets.add(set));
      }
      document.querySelectorAll(".set-button").forEach(btn => {
        if(selectedSets.has(btn.textContent)) {
          btn.classList.add("selected");
        } else {
          btn.classList.remove("selected");
        }
      });
      
      // è¿‡æ»¤å¡ç‰Œæ˜¾ç¤º
      filterCardsBySet();
      
      // æ¢å¤å¡ç‰Œé€‰æ‹©
      selectedCards.clear();
      item.cards.forEach(id=>selectedCards.add(id));
      document.querySelectorAll(".card-button").forEach(btn => {
        const cardId = btn.textContent.split(' ')[0];
        if(selectedCards.has(cardId)) {
          btn.classList.add("selected");
        } else {
          btn.classList.remove("selected");
        }
      });
      updatePreview();
      output.value=item.text;
    };
    historyList.appendChild(div);
  });
}

function filterHistory(){
  const keyword=document.getElementById("historySearch").value.trim();
  historyList.innerHTML="";
  history.filter(item=>item.text.includes(keyword)||item.id.includes(keyword)||item.name.includes(keyword)).forEach(item=>{
    const div=document.createElement("div");
    div.className="history-item";
    const setsInfo = item.sets ? ` [${item.sets.join(',')}]` : '';
    div.innerHTML=`${item.text.replace(/\n/g," ")}${setsInfo} <span style="color:gray">(${item.timestamp})</span>`;
    div.onclick=()=>{
      document.getElementById("idInput").value=item.id;
      document.getElementById("nameInput").value=item.name;
      
      // æ¢å¤SETé€‰æ‹©
      selectedSets.clear();
      if (item.sets) {
        item.sets.forEach(set => selectedSets.add(set));
      }
      document.querySelectorAll(".set-button").forEach(btn => {
        if(selectedSets.has(btn.textContent)) {
          btn.classList.add("selected");
        } else {
          btn.classList.remove("selected");
        }
      });
      
      // è¿‡æ»¤å¡ç‰Œæ˜¾ç¤º
      filterCardsBySet();
      
      // æ¢å¤å¡ç‰Œé€‰æ‹©
      selectedCards.clear();
      item.cards.forEach(id=>selectedCards.add(id));
      document.querySelectorAll(".card-button").forEach(btn => {
        const cardId = btn.textContent.split(' ')[0];
        if(selectedCards.has(cardId)) {
          btn.classList.add("selected");
        } else {
          btn.classList.remove("selected");
        }
      });
      updatePreview();
      output.value=item.text;
    };
    historyList.appendChild(div);
  });
}

function clearHistory(){
  if(confirm("ç¡®å®šæ¸…ç©ºå†å²è®°å½•å—ï¼Ÿ")){
    history.length=0;
    updateHistory();
  }
}
</script>
</body>
</html>